<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="test-token">
    <title>Test Tombol Kirim Email</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2>Test Tombol Kirim Email</h2>
        
        <table class="table table-bordered mt-4">
            <thead class="table-dark">
                <tr>
                    <th>No. Pinjaman</th>
                    <th>Nama</th>
                    <th>ðŸ“§ Email</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>PNJ-202511-0012</td>
                    <td>YANDI MULYADI</td>
                    <td>
                        <div class="text-center">
                            <span class="badge bg-warning text-dark">
                                <i class="bi bi-clock"></i> Belum
                            </span>
                            <br>
                            <button 
                                class="btn btn-sm btn-primary mt-1 btn-kirim-email" 
                                data-pinjaman-id="12"
                                data-email="yandimulyadi331@gmail.com"
                                title="Kirim email ke yandimulyadi331@gmail.com"
                                style="font-size: 10px; padding: 2px 6px;">
                                <i class="bi bi-send"></i> Kirim
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Handle tombol kirim email
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Loaded - Setting up email buttons');
            const btnKirimEmailList = document.querySelectorAll('.btn-kirim-email');
            console.log('Found email buttons:', btnKirimEmailList.length);
            
            btnKirimEmailList.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Button clicked!');
                    const pinjamanId = this.dataset.pinjamanId;
                    const email = this.dataset.email;
                    console.log('Pinjaman ID:', pinjamanId, 'Email:', email);
                    
                    Swal.fire({
                        title: 'ðŸ“§ Kirim Email Notifikasi',
                        html: `
                            <div style="text-align: left; padding: 20px;">
                                <p style="font-size: 16px; margin-bottom: 15px;">
                                    Kirim notifikasi email pinjaman jatuh tempo?
                                </p>
                                <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; border-left: 4px solid #0d6efd;">
                                    <p style="margin: 5px 0;"><strong>ðŸ“§ Email Tujuan:</strong></p>
                                    <p style="margin: 5px 0; color: #0066cc; font-weight: 600;">${email}</p>
                                </div>
                            </div>
                        `,
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonColor: '#0d6efd',
                        cancelButtonColor: '#6c757d',
                        confirmButtonText: '<i class="bi bi-send"></i> Kirim Sekarang',
                        cancelButtonText: '<i class="bi bi-x-circle"></i> Batal',
                        width: '600px',
                        customClass: {
                            confirmButton: 'btn btn-primary btn-lg px-4',
                            cancelButton: 'btn btn-secondary btn-lg px-4'
                        },
                        buttonsStyling: false,
                        reverseButtons: true
                    }).then((result) => {
                        if (result.isConfirmed) {
                            console.log('User confirmed, calling kirimEmail');
                            kirimEmail(pinjamanId, email);
                        }
                    });
                });
            });
        });

        // Function kirim email via AJAX
        function kirimEmail(pinjamanId, email) {
            console.log('kirimEmail function called:', pinjamanId, email);
            
            Swal.fire({
                title: 'ðŸ“¤ Mengirim Email...',
                html: `Mohon tunggu, sedang mengirim ke <strong>${email}</strong>`,
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            const url = `/pinjaman/${pinjamanId}/kirim-email`;
            console.log('Sending request to:', url);
            
            // Simulate AJAX - replace with real fetch in production
            setTimeout(() => {
                console.log('Simulating success response');
                Swal.fire({
                    title: 'âœ… Email Terkirim!',
                    html: `
                        <div style="text-align: left; padding: 20px;">
                            <p style="font-size: 16px; margin-bottom: 15px;">
                                Email notifikasi berhasil dikirim!
                            </p>
                            <div style="background: #d1e7dd; padding: 15px; border-radius: 8px; border-left: 4px solid #198754;">
                                <p style="margin: 5px 0;"><strong>ðŸ“§ Email Tujuan:</strong> ${email}</p>
                                <p style="margin: 5px 0;"><strong>ðŸ“‹ Tipe:</strong> jatuh_tempo_hari_ini</p>
                            </div>
                        </div>
                    `,
                    icon: 'success',
                    confirmButtonColor: '#198754',
                    confirmButtonText: '<i class="bi bi-check-circle"></i> OK',
                    customClass: {
                        confirmButton: 'btn btn-success btn-lg px-5'
                    },
                    buttonsStyling: false
                });
            }, 2000);
        }
    </script>
</body>
</html>
